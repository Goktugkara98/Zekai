<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat.js UI Bileşenleri Fonksiyon Raporu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f0f9ff; /* Açık mavi arka plan */
        }
        .function-section {
            background-color: #ffffff;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 2rem; /* 32px */
            padding: 1.5rem; /* 24px */
            border-left: 4px solid #22c55e; /* Yeşil 500 kenarlık */
        }
        .function-title-text {
            color: #15803d; /* Yeşil 700 */
            font-weight: 600; /* Yarı kalın */
        }
        .code-block { 
            background-color: #1e293b; /* Gri 800 */
            color: #e2e8f0; /* Gri 200 */
            padding: 1rem; /* 16px */
            border-radius: 0.5rem; /* 8px */
            margin-top: 1rem; /* 16px */
            margin-bottom: 1rem; /* 16px */
            white-space: pre-wrap; 
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.875rem; /* 14px */
            line-height: 1.5; 
            overflow-x: auto; 
        }
        .explanation-summary {
            background-color: #f0fdf4; /* Yeşil 50 */
            padding: 0.75rem 1rem; /* 12px 16px */
            border-radius: 0.5rem; /* 8px */
            margin-bottom: 0.5rem; /* 8px */
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #166534; /* Yeşil 800 */
            font-weight: 500; /* Orta */
            border: 1px solid #bbf7d0; /* Yeşil 200 */
        }
        .explanation-summary:hover {
            background-color: #dcfce7; /* Yeşil 100 */
        }
        .explanation-details { 
            margin-left: 1rem; /* 16px */
            padding-left: 1rem; /* 16px */
            border-left: 3px solid #86efac; /* Yeşil 300 */
            padding-top: 0.5rem; /* 8px */
            padding-bottom: 0.5rem; /* 8px */
            color: #374151; /* Gri 700 */
        }
        .explanation-details p {
            margin-bottom: 0.75rem; /* 12px */
        }
        .explanation-details strong {
            color: #1f2937; /* Gri 800 */
        }
        details > summary { 
            list-style: none; 
        }
        details > summary::-webkit-details-marker { 
            display: none; 
        }
        /* Firefox için */
        details > summary::marker {
            display: none;
        }
        .chevron::before {
            border-style: solid;
            border-width: 0.15em 0.15em 0 0;
            content: '';
            display: inline-block;
            height: 0.45em;
            left: 0.15em;
            position: relative;
            top: 0.15em;
            transform: rotate(-45deg);
            vertical-align: top;
            width: 0.45em;
            transition: transform 0.2s ease-in-out;
        }
        details[open] > summary .chevron::before {
            transform: rotate(135deg);
        }
        .global-vars { /* Global değişkenler için stil, gerekirse kullanılır */
            background-color: #fefce8; /* Sarı 50 */
            border: 1px solid #fde047; /* Sarı 300 */
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        .global-vars code {
            background-color: #fef9c3; /* Sarı 100 */
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            color: #713f12; /* Sarı 800 */
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-xl p-6 md:p-8">
        <header class="mb-8 pb-6 border-b border-gray-300">
            <h1 class="text-4xl font-bold text-center text-green-700"><code>chat.js</code> UI Bileşenleri Fonksiyon Raporu</h1>
            <p class="text-center text-gray-600 mt-3 text-lg"><code>chat.js</code> dosyasının "UI Bileşenleri" (UI Components) olarak adlandırılan bölümündeki fonksiyonların ve komutlarının detaylı açıklaması.</p>
        </header>

        <section id="ui-components-overview" class="mb-10 p-6 bg-green-50 rounded-lg border border-green-200">
            <h2 class="text-2xl font-semibold text-green-600 mb-3">2. UI Bileşenleri (UI Components)</h2>
            <p class="text-gray-700 leading-relaxed">
                Bu bölüm, sohbet arayüzünün görsel elemanlarını oluşturan fonksiyonları içerir. 
                Yeni sohbet pencerelerinin ve bu pencereler içindeki mesajların HTML yapılarını dinamik olarak üretmekten sorumludur. 
                Bu sayede, kullanıcı etkileşimlerine ve uygulama durumuna göre arayüz güncellenebilir.
            </p>
        </section>

        <section class="function-section" id="chat-element-factories">
            <h3 class="text-xl function-title-text mb-3">2.1 Sohbet Elemanı Fabrikaları (Chat Element Factories)</h3>
            <p class="text-gray-600 mb-4">Bu alt bölüm, sohbet pencerelerinin ana HTML yapısını oluşturan fonksiyonu içerir.</p>
            
            <h4 class="text-lg font-semibold text-gray-700 mt-4">Fonksiyon: <code>createChatElement(chatData)</code></h4>
            <div class="code-block">
function createChatElement(chatData) {
    log('debug', 'Creating chat element', chatData);
    
    const aiModel = window.state.aiTypes.find(m => m.id === chatData.aiModelId) || 
                    (window.state.aiTypes && window.state.aiTypes.length > 0 ? window.state.aiTypes[0] : null) || 
                    { name: \`Unknown AI (ID: ${chatData.aiModelId})\`, icon: 'bi bi-question-circle' }; 
    
    const chatWindow = document.createElement('div');
    chatWindow.className = 'chat-window';
    chatWindow.setAttribute('data-chat-id', chatData.id);
    
    const isModelLocked = chatData.messages && chatData.messages.some(msg => msg.isUser);
    const modelSelectionClass = isModelLocked ? 'model-locked' : 'model-changeable';
    const modelSelectionTitle = isModelLocked ? 'Model locked - conversation already started' : 'Click to change AI model';
    
    chatWindow.innerHTML = \`
        &lt;div class="chat-header"&gt;
            &lt;div class="chat-title ${modelSelectionClass}" title="${modelSelectionTitle}"&gt;
                &lt;i class="${aiModel.icon}"&gt;&lt;/i&gt;
                &lt;span&gt;${aiModel.name} (ID: ${chatData.id.slice(-4)})&lt;/span&gt;
                ${!isModelLocked ? '&lt;i class="bi bi-chevron-down model-selector-icon"&gt;&lt;/i&gt;' : 
                  '&lt;i class="bi bi-lock-fill model-locked-icon"&gt;&lt;/i&gt;'}
            &lt;/div&gt;
            &lt;div class="chat-controls"&gt;
                &lt;button class="chat-control-btn chat-minimize-btn" title="Minimize Chat"&gt;
                    &lt;i class="bi bi-dash-lg"&gt;&lt;/i&gt;
                &lt;/button&gt;
                &lt;button class="chat-control-btn chat-close-btn" title="Close Chat"&gt;
                    &lt;i class="bi bi-x"&gt;&lt;/i&gt;
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="chat-messages"&gt;
            ${chatData.messages && chatData.messages.length > 0 ? 
                chatData.messages.map(msg => createMessageHTML(msg, !msg.isUser, aiModel.name)).join('') : 
                createWelcomeMessageHTML(aiModel.name)
            }
        &lt;/div&gt;
        &lt;div class="chat-input-container"&gt;
            &lt;div class="chat-input-group"&gt;
                &lt;input type="text" class="chat-input" placeholder="Type your message..."&gt;
                &lt;button class="chat-send-btn"&gt;
                    &lt;i class="bi bi-send"&gt;&lt;/i&gt;
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    \`;
    
    return chatWindow;
}
            </div>
            <details class="mt-2">
                <summary class="explanation-summary">
                    <span>Komut Açıklamaları</span>
                    <span class="chevron"></span>
                </summary>
                <div class="explanation-details">
                    <p><strong><code>log('debug', 'Creating chat element', chatData);</code></strong>: Fonksiyonun çağrıldığını ve hangi <code>chatData</code> ile çağrıldığını belirten bir debug mesajı loglar.</p>
                    <p><strong><code>const aiModel = window.state.aiTypes.find(m => m.id === chatData.aiModelId) || ... ;</code></strong>: <code>chatData</code> içinde belirtilen <code>aiModelId</code>'ye karşılık gelen yapay zeka model bilgisini global <code>window.state.aiTypes</code> dizisinden bulmaya çalışır.
                        <ul>
                            <li><strong><code>window.state.aiTypes.find(m => m.id === chatData.aiModelId)</code></strong>: <code>aiTypes</code> dizisindeki her bir <code>m</code> (model) için <code>m.id</code>'nin <code>chatData.aiModelId</code> ile eşleşip eşleşmediğini kontrol eder. Eşleşen ilk modeli döndürür.</li>
                            <li><strong><code>|| (window.state.aiTypes && window.state.aiTypes.length > 0 ? window.state.aiTypes[0] : null)</code></strong>: Eğer yukarıdaki arama bir sonuç vermezse (<code>||</code> operatörü ile bir sonraki ifadeye geçilir) ve <code>aiTypes</code> dizisi mevcut ve boş değilse, dizideki ilk yapay zeka modelini varsayılan olarak kullanır. Eğer dizi boşsa <code>null</code> döner.</li>
                            <li><strong><code>|| { name: \`Unknown AI (ID: ${chatData.aiModelId})\`, icon: 'bi bi-question-circle' }</code></strong>: Eğer önceki adımlarda da bir model bulunamazsa (örneğin <code>aiTypes</code> dizisi tanımsızsa veya boşsa), bilinmeyen bir yapay zeka modeli için varsayılan bir obje oluşturur. Bu obje, modelin adını ve bir ikon sınıfını içerir.</li>
                        </ul>
                    </p>
                    <p><strong><code>const chatWindow = document.createElement('div');</code></strong>: Yeni bir HTML <code>&lt;div&gt;</code> elemanı oluşturur. Bu, sohbet penceresinin ana kapsayıcısı olacaktır.</p>
                    <p><strong><code>chatWindow.className = 'chat-window';</code></strong>: Oluşturulan <code>&lt;div&gt;</code> elemanına <code>chat-window</code> CSS sınıfını atar. Bu, stil vermek için kullanılır.</p>
                    <p><strong><code>chatWindow.setAttribute('data-chat-id', chatData.id);</code></strong>: Oluşturulan <code>&lt;div&gt;</code> elemanına <code>data-chat-id</code> adında bir özel veri niteliği (data attribute) ekler ve değer olarak <code>chatData.id</code>'yi atar. Bu, daha sonra bu sohbet penceresini JavaScript ile kolayca bulmak ve tanımlamak için kullanılır.</p>
                    <p><strong><code>const isModelLocked = chatData.messages && chatData.messages.some(msg => msg.isUser);</code></strong>: Sohbet penceresindeki yapay zeka modelinin değiştirilip değiştirilemeyeceğini belirler.
                        <ul>
                            <li><strong><code>chatData.messages && chatData.messages.some(msg => msg.isUser)</code></strong>: Eğer <code>chatData</code> içinde <code>messages</code> dizisi varsa ve bu dizide en az bir mesaj (<code>msg</code>) <code>msg.isUser</code> özelliği <code>true</code> ise (yani kullanıcı tarafından gönderilmiş bir mesaj varsa), <code>isModelLocked</code> değişkeni <code>true</code> olur. Aksi takdirde <code>false</code> olur.</li>
                        </ul>
                    </p>
                    <p><strong><code>const modelSelectionClass = isModelLocked ? 'model-locked' : 'model-changeable';</code></strong>: <code>isModelLocked</code> değişkeninin değerine göre sohbet başlığına atanacak CSS sınıfını belirler. Model kilitliyse <code>model-locked</code>, değilse <code>model-changeable</code> sınıfı atanır.</p>
                    <p><strong><code>const modelSelectionTitle = isModelLocked ? 'Model locked - conversation already started' : 'Click to change AI model';</code></strong>: Modelin kilitli olup olmamasına göre sohbet başlığına eklenecek <code>title</code> (ipucu) metnini belirler.</p>
                    <p><strong><code>chatWindow.innerHTML = \`...\`;</code></strong>: Oluşturulan <code>chatWindow</code> (<code>&lt;div&gt;</code>) elemanının iç HTML yapısını bir template literal (şablon dizisi) kullanarak ayarlar. Bu yapı, sohbet penceresinin başlığını, kontrol düğmelerini (kapatma, küçültme), mesaj alanını ve mesaj giriş alanını içerir.
                        <ul>
                            <li><strong><code>${modelSelectionClass}</code></strong> ve <strong><code>${modelSelectionTitle}</code></strong>: Yukarıda belirlenen CSS sınıfını ve başlık metnini HTML'e yerleştirir.</li>
                            <li><strong><code>&lt;i class="${aiModel.icon}"&gt;&lt;/i&gt;</code></strong> ve <strong><code>&lt;span&gt;${aiModel.name} (ID: ${chatData.id.slice(-4)})&lt;/span&gt;</code></strong>: Yapay zeka modelinin ikonunu ve adını (ID'sinin son 4 hanesiyle birlikte) sohbet başlığında gösterir.</li>
                            <li><strong><code>${!isModelLocked ? '&lt;i class="bi bi-chevron-down model-selector-icon"&gt;&lt;/i&gt;' : '&lt;i class="bi bi-lock-fill model-locked-icon"&gt;&lt;/i&gt;'}</code></strong>: Model kilitli değilse bir aşağı ok ikonu (model seçimi için), kilitliyse bir kilit ikonu gösterir.</li>
                            <li><strong><code>${chatData.messages && chatData.messages.length > 0 ? ... : createWelcomeMessageHTML(aiModel.name)}</code></strong>: Mesaj alanının içeriğini belirler. Eğer <code>chatData.messages</code> dizisi varsa ve içinde mesajlar varsa, bu mesajları <code>createMessageHTML</code> fonksiyonunu kullanarak HTML'e dönüştürür (<code>.map()</code> ve <code>.join('')</code> ile). Eğer hiç mesaj yoksa, <code>createWelcomeMessageHTML</code> fonksiyonunu çağırarak bir karşılama mesajı gösterir.</li>
                        </ul>
                    </p>
                    <p><strong><code>return chatWindow;</code></strong>: Tamamlanmış ve içi doldurulmuş sohbet penceresi DOM elemanını döndürür.</p>
                </div>
            </details>
        </section>

        <section class="function-section" id="message-html-generators">
            <h3 class="text-xl function-title-text mb-3">2.2 Mesaj HTML Üreteçleri (Message HTML Generators)</h3>
            <p class="text-gray-600 mb-4">Bu alt bölüm, sohbet penceresi içinde gösterilecek bireysel mesajların ve karşılama mesajının HTML yapısını oluşturan fonksiyonları içerir.</p>

            <h4 class="text-lg font-semibold text-gray-700 mt-4">Fonksiyon: <code>createMessageHTML(message, isFirstAIMessage = false, aiName = '')</code></h4>
            <div class="code-block">
function createMessageHTML(message, isFirstAIMessage = false, aiName = '') {
    const messageClass = message.isUser ? 'user-message' : 'ai-message';
    const timestamp = new Date(message.timestamp || Date.now()).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    let messageContent = message.text;
    if (!message.isUser && aiName) { 
        messageContent = \`&lt;div class="ai-model-indicator"&gt;&lt;i class="bi bi-robot"&gt;&lt;/i&gt; ${aiName}&lt;/div&gt;${messageContent}\`;
    }
    
    return \`
        &lt;div class="message ${messageClass}"&gt;
            &lt;div class="message-content"&gt;
                ${messageContent}
            &lt;/div&gt;
            &lt;div class="message-time"&gt;${timestamp}&lt;/div&gt;
        &lt;/div&gt;
    \`;
}
            </div>
            <details class="mt-2">
                <summary class="explanation-summary">
                    <span>Komut Açıklamaları</span>
                    <span class="chevron"></span>
                </summary>
                <div class="explanation-details">
                    <p><strong><code>const messageClass = message.isUser ? 'user-message' : 'ai-message';</code></strong>: Mesajın kullanıcıya mı yoksa yapay zekaya mı ait olduğuna bağlı olarak CSS sınıfını belirler. <code>message.isUser</code> doğruysa <code>user-message</code>, yanlışsa <code>ai-message</code> sınıfı atanır.</p>
                    <p><strong><code>const timestamp = new Date(message.timestamp || Date.now()).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});</code></strong>: Mesajın zaman damgasını formatlar.
                        <ul>
                            <li><strong><code>message.timestamp || Date.now()</code></strong>: Eğer <code>message</code> objesinde bir <code>timestamp</code> özelliği varsa onu kullanır, yoksa o anki zamanı (<code>Date.now()</code>) alır.</li>
                            <li><strong><code>new Date(...)</code></strong>: Alınan zaman damgasından bir <code>Date</code> objesi oluşturur.</li>
                            <li><strong><code>.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})</code></strong>: Tarih objesini yerel saat formatına göre "HH:MM" şeklinde (örneğin, "14:30") bir string'e dönüştürür.</li>
                        </ul>
                    </p>
                    <p><strong><code>let messageContent = message.text;</code></strong>: Mesajın asıl metnini <code>messageContent</code> değişkenine atar.</p>
                    <p><strong><code>if (!message.isUser && aiName) { ... }</code></strong>: Eğer mesaj yapay zekaya aitse (<code>!message.isUser</code>) ve <code>aiName</code> (yapay zeka adı) parametresi verilmişse, mesaj içeriğinin başına yapay zeka modelinin adını ve bir robot ikonu ekler. (Not: Orijinal koddaki <code>isFirstAIMessage</code> kontrolü kaldırılmış, bu da her AI mesajında model adının gösterilebileceği anlamına gelir eğer <code>aiName</code> sağlanırsa.)</p>
                    <p><strong><code>messageContent = \`&lt;div class="ai-model-indicator"&gt;...&lt;/div&gt;${messageContent}\`;</code></strong>: Yapay zeka adı ve ikonu içeren HTML'i mevcut mesaj içeriğinin başına ekler.</p>
                    <p><strong><code>return \`...\`;</code></strong>: Mesaj için tam HTML yapısını bir template literal kullanarak döndürür. Bu yapı, mesajın sınıfını, içeriğini ve zaman damgasını içerir.</p>
                </div>
            </details>

            <h4 class="text-lg font-semibold text-gray-700 mt-6">Fonksiyon: <code>createWelcomeMessageHTML(aiName)</code></h4>
            <div class="code-block">
function createWelcomeMessageHTML(aiName) {
    return \`
        &lt;div class="message ai-message"&gt;
            &lt;div class="message-content"&gt;
                &lt;div class="ai-model-indicator"&gt;&lt;i class="bi bi-robot"&gt;&lt;/i&gt; ${aiName}&lt;/div&gt;
                &lt;p&gt;Hello! I'm ${aiName}. How can I assist you today?&lt;/p&gt;
            &lt;/div&gt;
            &lt;div class="message-time"&gt;${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}&lt;/div&gt;
        &lt;/div&gt;
    \`;
}
            </div>
            <details class="mt-2">
                <summary class="explanation-summary">
                    <span>Komut Açıklamaları</span>
                    <span class="chevron"></span>
                </summary>
                <div class="explanation-details">
                    <p><strong><code>return \`...\`;</code></strong>: Yeni bir sohbet penceresi ilk açıldığında gösterilecek olan karşılama mesajının HTML yapısını bir template literal kullanarak döndürür.</p>
                    <ul>
                        <li><strong><code>&lt;div class="message ai-message"&gt;</code></strong>: Mesajın bir yapay zeka mesajı olduğunu belirten CSS sınıflarını atar.</li>
                        <li><strong><code>&lt;div class="ai-model-indicator"&gt;&lt;i class="bi bi-robot"&gt;&lt;/i&gt; ${aiName}&lt;/div&gt;</code></strong>: Yapay zeka modelinin adını ve bir robot ikonu gösterir. <code>${aiName}</code>, fonksiyona parametre olarak gelen yapay zeka adını ifade eder.</li>
                        <li><strong><code>&lt;p&gt;Hello! I'm ${aiName}. How can I assist you today?&lt;/p&gt;</code></strong>: Standart bir karşılama metni. <code>${aiName}</code> yine yapay zeka adını içerir.</li>
                        <li><strong><code>&lt;div class="message-time"&gt;${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}&lt;/div&gt;</code></strong>: Karşılama mesajının oluşturulduğu anki zamanı "HH:MM" formatında gösterir.</li>
                    </ul>
                </div>
            </details>
        </section>

    </div>
</body>
</html>
